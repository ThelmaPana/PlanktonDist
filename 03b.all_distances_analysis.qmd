---
title: "Test for overall randomness of plankton distribution"
author: "Thelma PanaÃ¯otis"
format: 
  html:
    toc: true
    embed-resources: true
editor: visual
lightbox: true
execute:
  warning: false
  cache: true
  freeze: false
---

```{r set_up}
#| echo: false
#| cache: false
source("utils.R")
```

Load computed distances

```{r read}
#| cache.lazy: false
load("data/03.all_distances.Rdata")
load("data/02.f_val_dist.Rdata")
```

Plot distribution

```{r dist}
df_all %>% 
  select(dist, dist_rand) %>% 
  unnest(c(dist, dist_rand)) %>% 
  pivot_longer(dist:dist_rand, names_to = "type", values_to = "dist") %>% 
  mutate(type = ifelse(type == "dist_rand", "rand", "data")) %>% 
  ggplot() + 
  geom_density(aes(x = dist, colour = type))
```

Plot ECDF.

```{r ecdf}
df_all %>% 
  select(dist, dist_rand) %>% 
  unnest(c(dist, dist_rand)) %>% 
  pivot_longer(dist:dist_rand, names_to = "type", values_to = "dist") %>% 
  mutate(type = ifelse(type == "dist_rand", "rand", "data")) %>% 
  ggplot() + 
  stat_ecdf(aes(x = dist, colour = type))
```

Here is the result of the kuiper test.

```{r kuiper}
df_all$test_stat
df_all$p_value
```

How does this compare to Kuiper test stats performed on null data with the same number of distances.

```{r f_val_dist}
ggplot() + 
  geom_boxplot(data = f_val_dist, aes(x = n_dist, y = test_stat, group = n_dist), colour = "gray") +
  geom_point(data = df_all, aes(x = n_dist, y = test_stat), colour = "red") +
  scale_x_log10() + scale_y_log10()
```

::: {.callout-note icon="false"}
## Conclusion

**Distances between planktonic organisms at the local scale differ from the distances that could be expected if plankton was randomly distributed.**
:::
