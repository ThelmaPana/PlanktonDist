---
title: "Analyze null Kuiper statistics for big datasets."
author: "Thelma Pana√Øotis"
format: 
  html:
    toc: true
    embed-resources: true
editor: visual
lightbox: true
execute:
  warning: false
  cache: true
  freeze: false
---

```{r set_up}
#| cache: false
source("utils.R")
```

## Read saved distances

Read null distances and stats.

```{r read_null}
load("data/04b.null_ks.Rdata")
```

Read plankton distances and stats.

```{r read_intra}
load("data/05a.all_distances_ks.Rdata")

# Log transform n dist and kuiper stat
df_all <- df_all %>% 
  mutate(
    log_n_dist = log10(n_dist),
    log_kuiper_stat = log10(kuiper_stat)
  )

```

Read big null stats.

```{r read_acant}
load("data/11a.null_ks_n_dist_big.Rdata")

# Log-transform n_dist and kuiper_stat
null_ks_n_dist_big <- null_ks_n_dist_big %>% 
  mutate(
    log_n_dist = log10(n_dist),
    log_kuiper_stat = log10(kuiper_stat)
    )

```

## Plot Kuiper stat VS number of distances

```{r plot_comp}

ggplot() + 
  geom_boxplot(data = null_ks_n_dist, aes(x = log_n_dist, y = log_kuiper_stat, group = n_dist), colour = "grey", width = 0.3) +
  #geom_boxplot(data = null_ks_n_dist_acant, aes(x = log_n_dist, y = log_kuiper_stat), width = 0.3) +
  geom_point(data = null_ks_n_dist_big, aes(x = log_n_dist, y = log_kuiper_stat)) +
  geom_point(data = df_all, aes(x = log_n_dist, y = log_kuiper_stat), colour = "red") +
  geom_polygon(data = null_ks_rib, aes(x = log_n_dist, y = y), alpha = 0.1) + 
  scale_x_continuous(labels = label_math(expr = 10^.x, format = force)) +
  scale_y_continuous(labels = label_math(expr = 10^.x, format = force)) +
  labs(x = "N distances", y = "Kuiper statistic") 
```

Black is big null (3 points on top of each ocher), grey is the global null data, red is observed plankton distances.

::: {.callout-note appearance="simple" icon="false"}
Null Kuiper statistics can be safely extrapolated for larger number of distances.
:::
